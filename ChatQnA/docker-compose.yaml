# Copyright (C) 2024 Intel Corporation
# SPDX-License-Identifier: Apache-2.0

# Container CI for ChatQnA
services:
  chatqna:
    build:
      args:
        http_proxy: ${http_proxy}
        https_proxy: ${https_proxy}
        no_proxy: ""
      context: ./docker
      dockerfile: Dockerfile
    image: ${REGISTRY:-opea}/chatqna:${GITHUB_RUN_NUMBER:-latest}
  chatqna-ui:
    build:
      context: ./docker/ui
      dockerfile: ./docker/Dockerfile
    extends: chatqna
    image: ${REGISTRY:-opea}/chatqna-ui:${GITHUB_RUN_NUMBER:-latest}
  chatqna-conversation-ui:
    build:
      args:
        BACKEND_SERVING_ENDPOINT: "http://${HOST_IP:-127.0.0.1}:8888/v1/chatqna"
        DATAPREP_SERVICE_ENDPOINT: "http://${HOST_IP:-127.0.0.1}:6007/v1/dataprep"
        DATAPREP_GET_FILE_ENDPOINT: "http://${HOST_IP:-127.0.0.1}:6008/v1/dataprep/get_file"
      context: ./docker/ui
      dockerfile: ./docker/Dockerfile.react
    extends: chatqna
    image: ${REGISTRY:-opea}/chatqna-conversation-ui:${GITHUB_RUN_NUMBER:-latest}
